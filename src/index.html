<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>ApotifyAPIJs</title>
    <base href="/" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" type="image/x-icon" href="favicon.ico" />
    <!-- <script
      src="https://sdk.scdn.co/spotify-player.js"
      async
      onload="func1()"
    ></script>

    <script type="text/javascript">
      var onSpotifyWebPlaybackSDKReady = function () {
        const token =
          "BQDJrRGyM5IrGObtB25m8gvw1mzcolhpkFmvWvMl0jdbeWZMcLuZHyhwl5olWpjrhPholCgiwc_z6ItvMkdJOOMQpIuA69LVC6viiuu7puKRGMDedvegA8WdAFBkEbMyEjXA7CGeaLtm86i1VmMKZDYCdXMhBeeOIT_LEyjLxYWRJPAtBH51rfriPDhRT35ITSoGgtJ0yk056focRzHqji0v9FdZSffDTkKQ2zH3rZH6V-NGrXo-YLyNF2Sruzb5pPn_AvnlqJhI1ShiwwsjpoC6gZ53cUVIQ0eYCSnzn1LmpcHHD1RN7D3K_UCexr5LG2Vo7wFcW7y71rQa8A";
        const player = new Spotify.Player({
          name: "Web Playback SDK Quick Start Player",
          getOAuthToken: (cb) => {
            cb(token);
          },
        });
        player.addListener("ready", ({ device_id }) => {
          console.log("Ready with Device ID", device_id);
        });

        player.addListener("not_ready", ({ device_id }) => {
          console.log("Device ID has gone offline", device_id);
        });
        player.connect();
      };
      var func1 = function () {
        debugger
        const play = ({
          spotify_uri,
          playerInstance: {
            _options: { getOAuthToken },
          },
        }) => {
          getOAuthToken((access_token) => {
            fetch(`https://api.spotify.com/v1/me/player/play?device_id=${id}`, {
              method: "PUT",
              body: JSON.stringify({ uris: [spotify_uri] }),
              headers: {
                "Content-Type": "application/json",
                Authorization: `Bearer ${access_token}`,
              },
            });
          });
        };

        play({
          playerInstance: new Spotify.Player({ name: "MyPlayer" }),
          spotify_uri: "spotify:track:7xGfFoTpQ2E7fRF5lN10tr",
        });
      };
    </script> -->
  </head>
  <body>
    <!-- <div id="amazon-root"></div>
    <a id="Logout">Logout</a>
    <script type="text/javascript">
      document.getElementById("Logout").onclick = function () {
        amazon.Login.logout();
      };
    </script>
    <script type="text/javascript">
      window.onAmazonLoginReady = function () {
        amazon.Login.setClientId(
          "amzn1.application-oa2-client.7d1fab614479493aa3af49ecba48ef73"
        );
      };
      (function (d) {
        var a = d.createElement("script");
        a.type = "text/javascript";
        a.async = true;
        a.id = "amazon-login-sdk";
        a.src = "https://assets.loginwithamazon.com/sdk/na/login1.js";
        d.getElementById("amazon-root").appendChild(a);
      })(document);
    </script>
    <a href id="LoginWithAmazon">
      <img
        border="0"
        alt="Login with Amazon"
        src="https://images-na.ssl-images-amazon.com/images/G/01/lwa/btnLWA_gold_156x32.png"
        width="156"
        height="32"
      />
    </a> -->
    <script type="text/javascript">
      // document.getElementById("LoginWithAmazon").onclick = function () {
        options = {};
        options.scope = "profile amazon_music:access";
        options.pkce = true;
        options.scope_data = {
          profile: { essential: false },
        };
        // amazon.Login.authorize(
        //   options,
        //   "https://anujsharma-bbd.github.io/Apotify-API-js/"
        // );
        amazon.Login.authorize(options, function (response) {
          if (response.error) {
            console.log("oauth error " + response.error);
            return;
          }
          amazon.Login.retrieveToken(response.code, function (response) {
            if (response.error) {
              console.log("oauth error " + response.error);
              return;
            }
            console.log("Access Token: " + response.access_token);
            amazon.Login.retrieveProfile(
              response.access_token,
              function (response) {
                console.log("Hello, " + response.profile.Name);
                console.log(
                  "Your e-mail address is " + response.profile.PrimaryEmail
                );
                console.log("Your unique ID is " + response.profile.CustomerId);
                if (window.console && window.console.log)
                  window.console.log(response);
              }
            );
          });
        });
        return false;
      };
    </script>
    <script>
      function Auth() {
        var CLIENT_ID = "";
        var REDIRECT_URI = "";

        if (location.host == "localhost:4200") {
          CLIENT_ID = "269f6c32fcd34a0bb588361cbc912afe";
          REDIRECT_URI = "http://localhost:4200/";
        } else {
          CLIENT_ID = "269f6c32fcd34a0bb588361cbc912afe";
          REDIRECT_URI = "http://lab.possan.se/thirtify/callback.html";
        }

        function getLoginURL(scopes) {
          return (
            "https://accounts.spotify.com/authorize?client_id=" +
            CLIENT_ID +
            "&redirect_uri=" +
            encodeURIComponent(REDIRECT_URI) +
            "&scope=" +
            encodeURIComponent(scopes.join(" ")) +
            "&response_type=token"
          );
        }

        return {
          openLogin: function () {
            var url = getLoginURL([
              "user-read-private",
              "playlist-read-private",
              "playlist-modify-public",
              "playlist-modify-private",
              "user-library-read",
              "user-library-modify",
              "user-follow-read",
              "user-follow-modify",
            ]);

            var width = 450,
              height = 730,
              left = screen.width / 2 - width / 2,
              top = screen.height / 2 - height / 2;

            var w = window.open(
              url,
              "Spotify",
              "menubar=no,location=no,resizable=no,scrollbars=no,status=no, width=" +
                width +
                ", height=" +
                height +
                ", top=" +
                top +
                ", left=" +
                left
            );
          },
          getAccessToken: function () {
            var expires = 0 + localStorage.getItem("an_expires", "0");
            if (new Date().getTime() > expires) {
              return "";
            }
            var token = localStorage.getItem("an_token", "");
            return token;
          },
          setAccessToken: function (token, expires_in) {
            localStorage.setItem("an_token", token);
            localStorage.setItem(
              "an_expires",
              new Date().getTime() + expires_in
            );
            // _token = token;
            // _expires = expires_in;
          },
          getUsername: function () {
            var username = localStorage.getItem("an_username", "");
            return username;
          },
          setUsername: function (username) {
            localStorage.setItem("an_username", username);
          },
          getUserCountry: function () {
            var userCountry = localStorage.getItem("an_usercountry", "US");
            return userCountry;
          },
          setUserCountry: function (userCountry) {
            localStorage.setItem("an_usercountry", userCountry);
          },
        };
      }
      function LoginClick() {
        new Auth().openLogin();
      }
    </script>
    <script type="text/javascript">
      // const clientId = "269f6c32fcd34a0bb588361cbc912afe";
      // const secretId = "5e39e1c3c9b044a4a080bf495e96aca7";
      // const getToken = async () => {
      //   const result = await fetch("https://accounts.spotify.com/api/token/", {
      //     method: "POST",
      //     headers: {
      //       "Content-Type": "application/x-www-form-urlencoded",
      //       Authorization: "Basic " + btoa(clientId + ":" + secretId),
      //     },
      //     body: "grant_type=client_credentials",
      //   });
      //   const data = await result().json();
      //   return data?.access_token;
      // };
      //getToken();
    </script>
    <button class="btn btn-secondary mb-3" onclick="LoginClick()">
      Login Spotify
    </button>
    <app-root></app-root>
  </body>
</html>
